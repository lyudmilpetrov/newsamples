!function(){function e(e,t,n,a,i,c,o){try{var r=e[c](o),s=r.value}catch(l){return void n(l)}r.done?t(s):Promise.resolve(s).then(a,i)}function t(t){return function(){var n=this,a=arguments;return new Promise((function(i,c){var o=t.apply(n,a);function r(t){e(o,i,c,r,s,"next",t)}function s(t){e(o,i,c,r,s,"throw",t)}r(void 0)}))}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function i(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{XURG:function(e,a,c){"use strict";c.r(a),c.d(a,"FaceRecognitionModule",(function(){return J}));var o=c("3Pt+"),r=c("ofXK"),s=c("tyNb"),l=c("S0DU"),u=c("qzk7"),d=c("fXoL"),h=c("42F4"),p=c("0IaG"),m=c("dNgK"),f=c("tk/3"),g=c("zkoq"),v=c("Wp6s"),b=c("A5z7"),w=c("NFeN"),y=c("Xa2L"),k=c("R0Ic"),R=c("LRne"),S=c("lJxs"),F=c("vkgz"),C=c("NJ9Y"),E=c("JIr8"),I=c("bTqV");function P(e,t){1&e&&d.Nb(0,"li"),2&e&&d.jc("@fadeInOut",t.$implicit.state)}var O,M=((O=function(){function e(t,a){n(this,e),this.http=a,this.text="Upload",this.param="file",this.target="https://file.io",this.accept="image/*",this.complete=new d.o,this.files=[]}return i(e,[{key:"ngOnInit",value:function(){}},{key:"onClick",value:function(){var e=this,t=document.getElementById("fileUpload"),n=new FileReader;t.onchange=function(){for(var a=function(a){var i=t.files[a];n.readAsDataURL(i),n.onload=function(t){var n={data:i,state:"in",result:t.target.result,inProgress:!1,progress:0,canRetry:!1,canCancel:!0};e.files.push(n),console.log(n),e.complete.emit(n)}},i=0;i<t.files.length;i++)a(i)},t.click()}},{key:"cancelFile",value:function(e){e.sub.unsubscribe(),this.removeFileFromArray(e)}},{key:"retryFile",value:function(e){this.uploadFile(e),e.canRetry=!1}},{key:"uploadFile",value:function(e){var t=this,n=new FormData;n.append(this.param,e.data),console.log(e);var a=new f.e("POST",this.target,n,{reportProgress:!0});e.inProgress=!0,e.sub=this.http.request(a).pipe(Object(S.a)((function(t){switch(t.type){case f.d.UploadProgress:e.progress=Math.round(100*t.loaded/t.total);break;case f.d.Response:return t}})),Object(F.a)((function(e){})),Object(C.a)(),Object(E.a)((function(t){return e.inProgress=!1,e.canRetry=!0,Object(R.a)(e.data.name+" upload failed.")}))).subscribe((function(n){"object"==typeof n&&(t.removeFileFromArray(e),t.complete.emit(e))}))}},{key:"uploadFiles",value:function(){var e=this;document.getElementById("fileUpload").value="",this.files.forEach((function(t){e.uploadFile(t)}))}},{key:"removeFileFromArray",value:function(e){var t=this.files.indexOf(e);t>-1&&this.files.splice(t,1)}}]),e}()).\u0275fac=function(e){return new(e||O)(d.Mb(O,12),d.Mb(f.a))},O.\u0275cmp=d.Gb({type:O,selectors:[["app-file-upload"]],inputs:{text:"text",param:"param",target:"target",accept:"accept"},outputs:{complete:"complete"},decls:8,vars:3,consts:[["mat-button","","color","warn",3,"click"],[4,"ngFor","ngForOf"],["type","file","id","fileUpload","name","fileUpload","multiple","multiple",2,"display","none",3,"accept"]],template:function(e,t){1&e&&(d.Sb(0,"button",0),d.ac("click",(function(){return t.onClick()})),d.Sb(1,"mat-icon"),d.Cc(2,"file_upload"),d.Rb(),d.Cc(3),d.Rb(),d.Nb(4,"br"),d.Sb(5,"ul"),d.Bc(6,P,1,1,"li",1),d.Rb(),d.Nb(7,"input",2)),2&e&&(d.Bb(3),d.Ec(" ",t.text,"\n"),d.Bb(3),d.jc("ngForOf",t.files),d.Bb(1),d.kc("accept",t.accept))},directives:[I.a,w.a,r.j],styles:["li[_ngcontent-%COMP%], ul[_ngcontent-%COMP%]{margin:0;padding:0;list-style:none}#file-label[_ngcontent-%COMP%]{display:inline-flex;vertical-align:middle;font-size:12px;line-height:18px}#file-label[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;text-align:center}#file-label[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{cursor:pointer}"],data:{animation:[Object(k.m)("fadeInOut",[Object(k.j)("in",Object(k.k)({opacity:100})),Object(k.l)("* => void",[Object(k.e)(300,Object(k.k)({opacity:0}))])])]}}),O),x=["video"],L=["canvasLast"],D=["canvasPrior"],j=["second"];function U(e,t){1&e&&(d.Sb(0,"div",15),d.Sb(1,"div",16),d.Nb(2,"mat-progress-spinner",17),d.Rb(),d.Rb())}function _(e,t){if(1&e){var n=d.Tb();d.Sb(0,"mat-chip",18),d.Sb(1,"app-file-upload",19,20),d.ac("complete",(function(e){return d.tc(n),d.ec().onFileCompleteFirst(e)})),d.Rb(),d.Rb()}}function W(e,t){if(1&e){var n=d.Tb();d.Sb(0,"mat-chip",18),d.Sb(1,"app-file-upload",19,21),d.ac("complete",(function(e){return d.tc(n),d.ec().onFileCompleteSecond(e)})),d.Rb(),d.Rb()}}var B,z,N=[{path:"",component:(B=function(){function e(t,a,i,c,o,r){n(this,e),this.renderer=t,this.os=a,this.dialog=i,this.snackBar=c,this.httpClient=o,this.ngZone=r,this.MODEL_URL="../../assets/weights",this.constraints={audio:!1,video:{facingMode:"selfie",width:{ideal:4096},height:{ideal:2160}}},this.mtcnnForwardParams={minFaceSize:200,scaleFactor:.709,maxNumScales:10,scoreThresholds:[.6,.7,.7]},this.videoWidth=0,this.videoHeight=0,this.result=0,this.valueInput="",this.images=[],this.matched="These faces belong to different people!",this.maxDescriptorDistance=.4,this.IsWait=!1,this.switchimage=1,this.showUpload=!1,this.showUpload="localhost"===window.location.hostname,Promise.all([this.loadF(this.MODEL_URL,"loadSsdMobilenetv1Model").then((function(e){console.log(e)})).catch((function(e){console.log(e)})).finally((function(){console.log("done")})),this.loadF(this.MODEL_URL,"loadFaceDetectionModel").then((function(e){console.log(e)})).catch((function(e){console.log(e)})).finally((function(){console.log("done")})),this.loadF(this.MODEL_URL,"loadFaceLandmarkModel").then((function(e){console.log(e)})).catch((function(e){console.log(e)})).finally((function(){console.log("done")})),this.loadF(this.MODEL_URL,"loadFaceRecognitionModel").then((function(e){console.log(e)})).catch((function(e){console.log(e)})).finally((function(){console.log("done")}))]).then((function(e){console.log(e)})).catch((function(e){return console.log(e)})).finally((function(){console.log("done loading"),console.log(u)}))}var a,c,o;return i(e,[{key:"ngOnInit",value:function(){console.log(u),this.breakpoint=window.innerWidth<=400?1:2,this.startCamera()}},{key:"onResize",value:function(e){this.breakpoint=e.target.innerWidth<=4?1:2}},{key:"loadF",value:(o=t(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u[n](t);case 2:case"end":return e.stop()}}),e)}))),function(e,t){return o.apply(this,arguments)})},{key:"handleError",value:function(e){console.log("Error: ",e)}},{key:"attachVideo",value:function(e){var t=this;this.renderer.setProperty(this.videoElement.nativeElement,"srcObject",e),this.renderer.listen(this.videoElement.nativeElement,"play",(function(e){t.videoHeight=t.videoElement.nativeElement.videoHeight,t.videoWidth=t.videoElement.nativeElement.videoWidth}))}},{key:"startCamera",value:function(){navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(this.constraints).then(this.attachVideo.bind(this)).catch(this.handleError):alert("Camera not available.")}},{key:"captureImageFirst",value:function(){this.renderer.setProperty(this.canvasLast.nativeElement,"width",this.videoWidth),this.renderer.setProperty(this.canvasLast.nativeElement,"height",this.videoHeight),this.canvasLast.nativeElement.getContext("2d").drawImage(this.videoElement.nativeElement,0,0)}},{key:"captureImageSecond",value:function(){this.renderer.setProperty(this.canvasPrior.nativeElement,"width",this.videoWidth),this.renderer.setProperty(this.canvasPrior.nativeElement,"height",this.videoHeight),this.canvasPrior.nativeElement.getContext("2d").drawImage(this.videoElement.nativeElement,0,0)}},{key:"capture",value:function(){1===this.switchimage?(this.switchimage=2,this.captureImageFirst()):(this.switchimage=1,this.captureImageSecond())}},{key:"compareImages",value:(c=t(regeneratorRuntime.mark((function e(){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.IsWait=!0,this.ngZone.run((function(){n.IsWait=!0})),setTimeout(t(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.computeSingleFaceDescriptors(n.canvasLast.nativeElement,n.canvasPrior.nativeElement,"Lyudmil",n.videoHeight,n.videoWidth);case 2:t=e.sent,console.log(t),t<=n.maxDescriptorDistance?(n.matched="The faces belong to one person!",n.openDialog(n.matched),n.IsWait=!1):(n.matched="It is hard to tell if that is the same person!",n.openDialog(n.matched),n.IsWait=!1);case 4:case"end":return e.stop()}}),e)}))),20);case 1:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"computeSingleFaceDescriptors",value:(a=t(regeneratorRuntime.mark((function e(t,n,a,i,c){var o,r,s,l,d,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={width:c,height:i},e.next=4,u.detectSingleFace(t).withFaceLandmarks().withFaceDescriptor();case 4:return r=e.sent,r=u.resizeResults(r,o),e.next=8,u.detectSingleFace(n).withFaceLandmarks().withFaceDescriptor();case 8:return s=e.sent,s=u.resizeResults(s,o),void 0!==r&&(u.draw.drawDetections(t,r),u.draw.drawFaceLandmarks(t,r)),void 0!==s&&(u.draw.drawDetections(n,s),u.draw.drawFaceLandmarks(n,s)),console.log([r.descriptor]),l=[s.descriptor],console.log(l),d=new u.LabeledFaceDescriptors("Prior",l),h=new u.FaceMatcher(d,this.maxDescriptorDistance),e.abrupt("return",[r].map((function(e){return h.findBestMatch(e.descriptor)}))[0]._distance);case 14:case"end":return e.stop()}}),e,this)}))),function(e,t,n,i,c){return a.apply(this,arguments)})},{key:"openDialog",value:function(e){this.dialog.open(l.a,{data:{message:e,buttonText:{ok:"Save",cancel:"No"}}}).afterClosed().subscribe((function(e){console.log(e)}))}},{key:"onFileCompleteFirst",value:function(e){var t=this,n=new Image;n.src=e.result,n.onload=function(){var e=n.naturalWidth,a=t.canvasLast.nativeElement.width,i=1;e>a&&(i=a/e);var c=n.naturalHeight,o=t.canvasLast.nativeElement.height,r=1;c>o&&(r=o/c);var s=r;i<r&&(s=i),s<1&&(c*=s,e*=s),t.canvasLast.nativeElement.height=c,t.canvasLast.nativeElement.width=e,t.clearFirst(),t.canvasLast.nativeElement.getContext("2d").drawImage(n,0,0,n.naturalWidth,n.naturalHeight,0,0,e,c)}}},{key:"onFileCompleteSecond",value:function(e){var t=this,n=new Image;n.src=e.result,n.onload=function(){var e=n.naturalWidth,a=t.canvasPrior.nativeElement.width,i=1;e>a&&(i=a/e);var c=n.naturalHeight,o=t.canvasPrior.nativeElement.height,r=1;c>o&&(r=o/c);var s=r;i<r&&(s=i),s<1&&(c*=s,e*=s),t.canvasPrior.nativeElement.height=c,t.canvasPrior.nativeElement.width=e,t.clearSecond(),t.canvasPrior.nativeElement.getContext("2d").drawImage(n,0,0,n.naturalWidth,n.naturalHeight,0,0,e,c)}}},{key:"clearFirst",value:function(){var e=this.canvasLast.nativeElement.getContext("2d");e.clearRect(0,0,e.canvas.width,e.canvas.height),e.restore()}},{key:"clearSecond",value:function(){var e=this.canvasPrior.nativeElement.getContext("2d");e.clearRect(0,0,e.canvas.width,e.canvas.height),e.restore()}},{key:"ngAfterViewInit",value:function(){console.log(this.secondUpload)}}]),e}(),B.\u0275fac=function(e){return new(e||B)(d.Mb(d.G),d.Mb(h.b),d.Mb(p.b),d.Mb(m.a),d.Mb(f.a),d.Mb(d.B))},B.\u0275cmp=d.Gb({type:B,selectors:[["ng-component"]],viewQuery:function(e,t){var n;1&e&&(d.xc(x,!0),d.xc(L,!0),d.xc(D,!0),d.Fc(j,!0)),2&e&&(d.pc(n=d.bc())&&(t.videoElement=n.first),d.pc(n=d.bc())&&(t.canvasLast=n.first),d.pc(n=d.bc())&&(t.canvasPrior=n.first),d.pc(n=d.bc())&&(t.secondUpload=n.first))},decls:52,vars:11,consts:[["class","overlay",4,"ngIf"],["rowHeight","3:1",3,"cols","gutterSize","resize"],[3,"colspan","rowspan"],[3,"click"],["selected","true",1,"pointer",3,"click"],[1,"p-1"],["autoplay","","muted","",1,"vid"],["video",""],["color","accent","selected","true",1,"pointer",3,"click"],[1,"close-right",3,"click"],[1,"p-1",3,"click"],[1,"vid"],["canvasLast",""],["color","accent","selected","true","class","pointer",4,"ngIf"],["canvasPrior",""],[1,"overlay"],[1,"center"],["diameter","100","mode","indeterminate"],["color","accent","selected","true",1,"pointer"],[3,"complete"],["first",""],["second",""]],template:function(e,t){1&e&&(d.Bc(0,U,3,0,"div",0),d.Sb(1,"mat-grid-list",1),d.ac("resize",(function(e){return t.onResize(e)}),!1,d.sc),d.Sb(2,"mat-grid-tile",2),d.Sb(3,"mat-card",3),d.ac("click",(function(){return t.capture()})),d.Sb(4,"mat-card-header"),d.Sb(5,"mat-card-subtitle"),d.Sb(6,"mat-chip",4),d.ac("click",(function(){return t.compareImages()})),d.Cc(7,"Compare images"),d.Rb(),d.Rb(),d.Rb(),d.Sb(8,"div",5),d.Nb(9,"video",6,7),d.Rb(),d.Sb(11,"mat-card-content"),d.Sb(12,"p"),d.Cc(13," Allow the browser to use your camera and click on video to capture image or press buttons below, or either click on image holders on the left/below "),d.Rb(),d.Rb(),d.Sb(14,"mat-card-actions"),d.Sb(15,"mat-chip-list"),d.Sb(16,"mat-chip",8),d.ac("click",(function(){return t.captureImageFirst()})),d.Cc(17,"Capture first image from camera"),d.Rb(),d.Sb(18,"mat-chip",8),d.ac("click",(function(){return t.captureImageSecond()})),d.Cc(19,"Capture second image from camera"),d.Rb(),d.Rb(),d.Rb(),d.Rb(),d.Rb(),d.Sb(20,"mat-grid-tile",2),d.Sb(21,"mat-card"),d.Sb(22,"mat-card-header"),d.Sb(23,"mat-icon",9),d.ac("click",(function(){return t.clearFirst()})),d.Cc(24,"cancel"),d.Rb(),d.Sb(25,"mat-card-subtitle"),d.Cc(26,"First Image "),d.Rb(),d.Rb(),d.Sb(27,"div",10),d.ac("click",(function(){return t.captureImageFirst()})),d.Nb(28,"canvas",11,12),d.Rb(),d.Sb(30,"mat-card-content",3),d.ac("click",(function(){return t.captureImageFirst()})),d.Rb(),d.Sb(31,"mat-card-actions"),d.Sb(32,"mat-chip-list"),d.Sb(33,"mat-chip",8),d.ac("click",(function(){return t.captureImageFirst()})),d.Cc(34,"Capture image from camera"),d.Rb(),d.Bc(35,_,3,0,"mat-chip",13),d.Rb(),d.Rb(),d.Rb(),d.Rb(),d.Sb(36,"mat-grid-tile",2),d.Sb(37,"mat-card"),d.Sb(38,"mat-card-header"),d.Sb(39,"mat-icon",9),d.ac("click",(function(){return t.clearSecond()})),d.Cc(40,"cancel"),d.Rb(),d.Sb(41,"mat-card-subtitle"),d.Cc(42,"Second Image "),d.Rb(),d.Rb(),d.Sb(43,"div",10),d.ac("click",(function(){return t.captureImageSecond()})),d.Nb(44,"canvas",11,14),d.Rb(),d.Sb(46,"mat-card-content",3),d.ac("click",(function(){return t.captureImageSecond()})),d.Rb(),d.Sb(47,"mat-card-actions"),d.Sb(48,"mat-chip-list"),d.Sb(49,"mat-chip",8),d.ac("click",(function(){return t.captureImageSecond()})),d.Cc(50,"Capture image from camera"),d.Rb(),d.Bc(51,W,3,0,"mat-chip",13),d.Rb(),d.Rb(),d.Rb(),d.Rb(),d.Rb()),2&e&&(d.jc("ngIf",t.IsWait),d.Bb(1),d.jc("cols",t.breakpoint)("gutterSize","10px"),d.Bb(1),d.jc("colspan",1)("rowspan",3),d.Bb(18),d.jc("colspan",1)("rowspan",2),d.Bb(15),d.jc("ngIf",t.showUpload),d.Bb(1),d.jc("colspan",1)("rowspan",2),d.Bb(15),d.jc("ngIf",t.showUpload))},directives:[r.k,g.a,g.c,v.a,v.d,v.f,b.a,v.c,v.b,b.b,w.a,y.a,M],styles:[".vid[_ngcontent-%COMP%]{width:100%;height:100%}.mat-chip[_ngcontent-%COMP%]{justify-content:space-between}.pointer[_ngcontent-%COMP%]{cursor:pointer}.center[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translateX(-50%) translateY(-50%)}.overlay[_ngcontent-%COMP%]{height:100vh;width:100%;background-color:rgba(0,0,0,.286);z-index:10;top:0;left:0;position:fixed;background:#000;opacity:.75!important}body[_ngcontent-%COMP%]{margin:0}.close-right[_ngcontent-%COMP%]{cursor:pointer;position:absolute;right:0;margin-right:10px}"]}),B)}],H=c("5dmV"),T=c("Q92/"),A=c("NyRW"),J=((z=function e(){n(this,e)}).\u0275mod=d.Kb({type:z}),z.\u0275inj=d.Jb({factory:function(e){return new(e||z)},providers:[h.b],imports:[[s.e.forChild(N),o.o,o.h,r.c,H.a,T.a,A.a]]}),z)}}])}();