(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{XURG:function(e,t,a){"use strict";a.r(t),a.d(t,"FaceRecognitionModule",(function(){return B}));var i=a("3Pt+"),n=a("ofXK"),c=a("tyNb"),o=a("S0DU"),s=a("qzk7"),r=a("fXoL"),l=a("42F4"),d=a("0IaG"),h=a("dNgK"),m=a("tk/3"),p=a("zkoq"),b=a("Wp6s"),g=a("A5z7"),u=a("NFeN"),v=a("Xa2L"),f=a("R0Ic"),w=a("LRne"),S=a("lJxs"),R=a("vkgz"),F=a("NJ9Y"),y=a("JIr8"),C=a("bTqV");function k(e,t){1&e&&r.Nb(0,"li"),2&e&&r.jc("@fadeInOut",t.$implicit.state)}let E=(()=>{class e{constructor(e,t){this.http=t,this.text="Upload",this.param="file",this.target="https://file.io",this.accept="image/*",this.complete=new r.o,this.files=[]}ngOnInit(){}onClick(){const e=document.getElementById("fileUpload"),t=new FileReader;e.onchange=()=>{for(let a=0;a<e.files.length;a++){const i=e.files[a];t.readAsDataURL(i),t.onload=e=>{const t={data:i,state:"in",result:e.target.result,inProgress:!1,progress:0,canRetry:!1,canCancel:!0};this.files.push(t),console.log(t),this.complete.emit(t)}}},e.click()}cancelFile(e){e.sub.unsubscribe(),this.removeFileFromArray(e)}retryFile(e){this.uploadFile(e),e.canRetry=!1}uploadFile(e){const t=new FormData;t.append(this.param,e.data),console.log(e);const a=new m.e("POST",this.target,t,{reportProgress:!0});e.inProgress=!0,e.sub=this.http.request(a).pipe(Object(S.a)(t=>{switch(t.type){case m.d.UploadProgress:e.progress=Math.round(100*t.loaded/t.total);break;case m.d.Response:return t}}),Object(R.a)(e=>{}),Object(F.a)(),Object(y.a)(t=>(e.inProgress=!1,e.canRetry=!0,Object(w.a)(e.data.name+" upload failed.")))).subscribe(t=>{"object"==typeof t&&(this.removeFileFromArray(e),this.complete.emit(e))})}uploadFiles(){document.getElementById("fileUpload").value="",this.files.forEach(e=>{this.uploadFile(e)})}removeFileFromArray(e){const t=this.files.indexOf(e);t>-1&&this.files.splice(t,1)}}return e.\u0275fac=function(t){return new(t||e)(r.Mb(e,12),r.Mb(m.a))},e.\u0275cmp=r.Gb({type:e,selectors:[["app-file-upload"]],inputs:{text:"text",param:"param",target:"target",accept:"accept"},outputs:{complete:"complete"},decls:8,vars:3,consts:[["mat-button","","color","warn",3,"click"],[4,"ngFor","ngForOf"],["type","file","id","fileUpload","name","fileUpload","multiple","multiple",2,"display","none",3,"accept"]],template:function(e,t){1&e&&(r.Sb(0,"button",0),r.ac("click",(function(){return t.onClick()})),r.Sb(1,"mat-icon"),r.Cc(2,"file_upload"),r.Rb(),r.Cc(3),r.Rb(),r.Nb(4,"br"),r.Sb(5,"ul"),r.Bc(6,k,1,1,"li",1),r.Rb(),r.Nb(7,"input",2)),2&e&&(r.Bb(3),r.Ec(" ",t.text,"\n"),r.Bb(3),r.jc("ngForOf",t.files),r.Bb(1),r.kc("accept",t.accept))},directives:[C.a,u.a,n.j],styles:["li[_ngcontent-%COMP%], ul[_ngcontent-%COMP%]{margin:0;padding:0;list-style:none}#file-label[_ngcontent-%COMP%]{display:inline-flex;vertical-align:middle;font-size:12px;line-height:18px}#file-label[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;text-align:center}#file-label[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{cursor:pointer}"],data:{animation:[Object(f.m)("fadeInOut",[Object(f.j)("in",Object(f.k)({opacity:100})),Object(f.l)("* => void",[Object(f.e)(300,Object(f.k)({opacity:0}))])])]}}),e})();const I=["video"],P=["canvasLast"],M=["canvasPrior"],O=["second"];function L(e,t){1&e&&(r.Sb(0,"div",15),r.Sb(1,"div",16),r.Nb(2,"mat-progress-spinner",17),r.Rb(),r.Rb())}function x(e,t){if(1&e){const e=r.Tb();r.Sb(0,"mat-chip",18),r.Sb(1,"app-file-upload",19,20),r.ac("complete",(function(t){return r.tc(e),r.ec().onFileCompleteFirst(t)})),r.Rb(),r.Rb()}}function D(e,t){if(1&e){const e=r.Tb();r.Sb(0,"mat-chip",18),r.Sb(1,"app-file-upload",19,21),r.ac("complete",(function(t){return r.tc(e),r.ec().onFileCompleteSecond(t)})),r.Rb(),r.Rb()}}const j=[{path:"",component:(()=>{class e{constructor(e,t,a,i,n,c){this.renderer=e,this.os=t,this.dialog=a,this.snackBar=i,this.httpClient=n,this.ngZone=c,this.MODEL_URL="../../assets/weights",this.constraints={audio:!1,video:{facingMode:"selfie",width:{ideal:4096},height:{ideal:2160}}},this.mtcnnForwardParams={minFaceSize:200,scaleFactor:.709,maxNumScales:10,scoreThresholds:[.6,.7,.7]},this.videoWidth=0,this.videoHeight=0,this.result=0,this.valueInput="",this.images=[],this.matched="These faces belong to different people!",this.maxDescriptorDistance=.4,this.IsWait=!1,this.switchimage=1,this.showUpload=!1,this.showUpload="localhost"===window.location.hostname,Promise.all([this.loadF(this.MODEL_URL,"loadSsdMobilenetv1Model").then(e=>{console.log(e)}).catch(e=>{console.log(e)}).finally(()=>{console.log("done")}),this.loadF(this.MODEL_URL,"loadFaceDetectionModel").then(e=>{console.log(e)}).catch(e=>{console.log(e)}).finally(()=>{console.log("done")}),this.loadF(this.MODEL_URL,"loadFaceLandmarkModel").then(e=>{console.log(e)}).catch(e=>{console.log(e)}).finally(()=>{console.log("done")}),this.loadF(this.MODEL_URL,"loadFaceRecognitionModel").then(e=>{console.log(e)}).catch(e=>{console.log(e)}).finally(()=>{console.log("done")})]).then(e=>{console.log(e)}).catch(e=>console.log(e)).finally(()=>{console.log("done loading"),console.log(s)})}ngOnInit(){console.log(s),this.breakpoint=window.innerWidth<=400?1:2,this.startCamera()}onResize(e){this.breakpoint=e.target.innerWidth<=4?1:2}async loadF(e,t){await s[t](e)}handleError(e){console.log("Error: ",e)}attachVideo(e){this.renderer.setProperty(this.videoElement.nativeElement,"srcObject",e),this.renderer.listen(this.videoElement.nativeElement,"play",e=>{this.videoHeight=this.videoElement.nativeElement.videoHeight,this.videoWidth=this.videoElement.nativeElement.videoWidth})}startCamera(){navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(this.constraints).then(this.attachVideo.bind(this)).catch(this.handleError):alert("Camera not available.")}captureImageFirst(){this.renderer.setProperty(this.canvasLast.nativeElement,"width",this.videoWidth),this.renderer.setProperty(this.canvasLast.nativeElement,"height",this.videoHeight),this.canvasLast.nativeElement.getContext("2d").drawImage(this.videoElement.nativeElement,0,0)}captureImageSecond(){this.renderer.setProperty(this.canvasPrior.nativeElement,"width",this.videoWidth),this.renderer.setProperty(this.canvasPrior.nativeElement,"height",this.videoHeight),this.canvasPrior.nativeElement.getContext("2d").drawImage(this.videoElement.nativeElement,0,0)}capture(){1===this.switchimage?(this.switchimage=2,this.captureImageFirst()):(this.switchimage=1,this.captureImageSecond())}async compareImages(){this.IsWait=!0,this.ngZone.run(()=>{this.IsWait=!0}),setTimeout(async()=>{const e=await this.computeSingleFaceDescriptors(this.canvasLast.nativeElement,this.canvasPrior.nativeElement,"Lyudmil",this.videoHeight,this.videoWidth);console.log(e),e<=this.maxDescriptorDistance?(this.matched="The faces belong to one person!",this.openDialog(this.matched),this.IsWait=!1):(this.matched="It is hard to tell if that is the same person!",this.openDialog(this.matched),this.IsWait=!1)},20)}async computeSingleFaceDescriptors(e,t,a,i,n){const c={width:n,height:i};let o=1,r=await s.detectSingleFace(e).withFaceLandmarks().withFaceDescriptor();r=s.resizeResults(r,c);let l=await s.detectSingleFace(t).withFaceLandmarks().withFaceDescriptor();l=s.resizeResults(l,c),void 0!==r&&(s.draw.drawDetections(e,r),s.draw.drawFaceLandmarks(e,r)),void 0!==l&&(s.draw.drawDetections(t,l),s.draw.drawFaceLandmarks(t,l)),console.log([r.descriptor]);const d=[l.descriptor];console.log(d);const h=new s.LabeledFaceDescriptors("Prior",d),m=new s.FaceMatcher(h,this.maxDescriptorDistance);return o=[r].map(e=>m.findBestMatch(e.descriptor))[0]._distance,o}openDialog(e){this.dialog.open(o.a,{data:{message:e,buttonText:{ok:"Save",cancel:"No"}}}).afterClosed().subscribe(e=>{console.log(e)})}onFileCompleteFirst(e){const t=new Image;t.src=e.result,t.onload=()=>{let e=t.naturalWidth;const a=this.canvasLast.nativeElement.width;let i=1;e>a&&(i=a/e);let n=t.naturalHeight;const c=this.canvasLast.nativeElement.height;let o=1;n>c&&(o=c/n);let s=o;i<o&&(s=i),s<1&&(n*=s,e*=s),this.canvasLast.nativeElement.height=n,this.canvasLast.nativeElement.width=e,this.clearFirst(),this.canvasLast.nativeElement.getContext("2d").drawImage(t,0,0,t.naturalWidth,t.naturalHeight,0,0,e,n)}}onFileCompleteSecond(e){const t=new Image;t.src=e.result,t.onload=()=>{let e=t.naturalWidth;const a=this.canvasPrior.nativeElement.width;let i=1;e>a&&(i=a/e);let n=t.naturalHeight;const c=this.canvasPrior.nativeElement.height;let o=1;n>c&&(o=c/n);let s=o;i<o&&(s=i),s<1&&(n*=s,e*=s),this.canvasPrior.nativeElement.height=n,this.canvasPrior.nativeElement.width=e,this.clearSecond(),this.canvasPrior.nativeElement.getContext("2d").drawImage(t,0,0,t.naturalWidth,t.naturalHeight,0,0,e,n)}}clearFirst(){const e=this.canvasLast.nativeElement.getContext("2d");e.clearRect(0,0,e.canvas.width,e.canvas.height),e.restore()}clearSecond(){const e=this.canvasPrior.nativeElement.getContext("2d");e.clearRect(0,0,e.canvas.width,e.canvas.height),e.restore()}ngAfterViewInit(){console.log(this.secondUpload)}}return e.\u0275fac=function(t){return new(t||e)(r.Mb(r.G),r.Mb(l.b),r.Mb(d.b),r.Mb(h.a),r.Mb(m.a),r.Mb(r.B))},e.\u0275cmp=r.Gb({type:e,selectors:[["ng-component"]],viewQuery:function(e,t){if(1&e&&(r.xc(I,!0),r.xc(P,!0),r.xc(M,!0),r.Fc(O,!0)),2&e){let e;r.pc(e=r.bc())&&(t.videoElement=e.first),r.pc(e=r.bc())&&(t.canvasLast=e.first),r.pc(e=r.bc())&&(t.canvasPrior=e.first),r.pc(e=r.bc())&&(t.secondUpload=e.first)}},decls:52,vars:11,consts:[["class","overlay",4,"ngIf"],["rowHeight","3:1",3,"cols","gutterSize","resize"],[3,"colspan","rowspan"],[3,"click"],["selected","true",1,"pointer",3,"click"],[1,"p-1"],["autoplay","","muted","",1,"vid"],["video",""],["color","accent","selected","true",1,"pointer",3,"click"],[1,"close-right",3,"click"],[1,"p-1",3,"click"],[1,"vid"],["canvasLast",""],["color","accent","selected","true","class","pointer",4,"ngIf"],["canvasPrior",""],[1,"overlay"],[1,"center"],["diameter","100","mode","indeterminate"],["color","accent","selected","true",1,"pointer"],[3,"complete"],["first",""],["second",""]],template:function(e,t){1&e&&(r.Bc(0,L,3,0,"div",0),r.Sb(1,"mat-grid-list",1),r.ac("resize",(function(e){return t.onResize(e)}),!1,r.sc),r.Sb(2,"mat-grid-tile",2),r.Sb(3,"mat-card",3),r.ac("click",(function(){return t.capture()})),r.Sb(4,"mat-card-header"),r.Sb(5,"mat-card-subtitle"),r.Sb(6,"mat-chip",4),r.ac("click",(function(){return t.compareImages()})),r.Cc(7,"Compare images"),r.Rb(),r.Rb(),r.Rb(),r.Sb(8,"div",5),r.Nb(9,"video",6,7),r.Rb(),r.Sb(11,"mat-card-content"),r.Sb(12,"p"),r.Cc(13," Allow the browser to use your camera and click on video to capture image or press buttons below, or either click on image holders on the left/below "),r.Rb(),r.Rb(),r.Sb(14,"mat-card-actions"),r.Sb(15,"mat-chip-list"),r.Sb(16,"mat-chip",8),r.ac("click",(function(){return t.captureImageFirst()})),r.Cc(17,"Capture first image from camera"),r.Rb(),r.Sb(18,"mat-chip",8),r.ac("click",(function(){return t.captureImageSecond()})),r.Cc(19,"Capture second image from camera"),r.Rb(),r.Rb(),r.Rb(),r.Rb(),r.Rb(),r.Sb(20,"mat-grid-tile",2),r.Sb(21,"mat-card"),r.Sb(22,"mat-card-header"),r.Sb(23,"mat-icon",9),r.ac("click",(function(){return t.clearFirst()})),r.Cc(24,"cancel"),r.Rb(),r.Sb(25,"mat-card-subtitle"),r.Cc(26,"First Image "),r.Rb(),r.Rb(),r.Sb(27,"div",10),r.ac("click",(function(){return t.captureImageFirst()})),r.Nb(28,"canvas",11,12),r.Rb(),r.Sb(30,"mat-card-content",3),r.ac("click",(function(){return t.captureImageFirst()})),r.Rb(),r.Sb(31,"mat-card-actions"),r.Sb(32,"mat-chip-list"),r.Sb(33,"mat-chip",8),r.ac("click",(function(){return t.captureImageFirst()})),r.Cc(34,"Capture image from camera"),r.Rb(),r.Bc(35,x,3,0,"mat-chip",13),r.Rb(),r.Rb(),r.Rb(),r.Rb(),r.Sb(36,"mat-grid-tile",2),r.Sb(37,"mat-card"),r.Sb(38,"mat-card-header"),r.Sb(39,"mat-icon",9),r.ac("click",(function(){return t.clearSecond()})),r.Cc(40,"cancel"),r.Rb(),r.Sb(41,"mat-card-subtitle"),r.Cc(42,"Second Image "),r.Rb(),r.Rb(),r.Sb(43,"div",10),r.ac("click",(function(){return t.captureImageSecond()})),r.Nb(44,"canvas",11,14),r.Rb(),r.Sb(46,"mat-card-content",3),r.ac("click",(function(){return t.captureImageSecond()})),r.Rb(),r.Sb(47,"mat-card-actions"),r.Sb(48,"mat-chip-list"),r.Sb(49,"mat-chip",8),r.ac("click",(function(){return t.captureImageSecond()})),r.Cc(50,"Capture image from camera"),r.Rb(),r.Bc(51,D,3,0,"mat-chip",13),r.Rb(),r.Rb(),r.Rb(),r.Rb(),r.Rb()),2&e&&(r.jc("ngIf",t.IsWait),r.Bb(1),r.jc("cols",t.breakpoint)("gutterSize","10px"),r.Bb(1),r.jc("colspan",1)("rowspan",3),r.Bb(18),r.jc("colspan",1)("rowspan",2),r.Bb(15),r.jc("ngIf",t.showUpload),r.Bb(1),r.jc("colspan",1)("rowspan",2),r.Bb(15),r.jc("ngIf",t.showUpload))},directives:[n.k,p.a,p.c,b.a,b.d,b.f,g.a,b.c,b.b,g.b,u.a,v.a,E],styles:[".vid[_ngcontent-%COMP%]{width:100%;height:100%}.mat-chip[_ngcontent-%COMP%]{justify-content:space-between}.pointer[_ngcontent-%COMP%]{cursor:pointer}.center[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translateX(-50%) translateY(-50%)}.overlay[_ngcontent-%COMP%]{height:100vh;width:100%;background-color:rgba(0,0,0,.286);z-index:10;top:0;left:0;position:fixed;background:#000;opacity:.75!important}body[_ngcontent-%COMP%]{margin:0}.close-right[_ngcontent-%COMP%]{cursor:pointer;position:absolute;right:0;margin-right:10px}"]}),e})()}];var U=a("5dmV"),_=a("Q92/"),W=a("NyRW");let B=(()=>{class e{}return e.\u0275mod=r.Kb({type:e}),e.\u0275inj=r.Jb({factory:function(t){return new(t||e)},providers:[l.b],imports:[[c.e.forChild(j),i.o,i.h,n.c,U.a,_.a,W.a]]}),e})()}}]);