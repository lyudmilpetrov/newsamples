!function(){function e(e,t,n,i,a,c,o){try{var r=e[c](o),s=r.value}catch(l){return void n(l)}r.done?t(s):Promise.resolve(s).then(i,a)}function t(t){return function(){var n=this,i=arguments;return new Promise((function(a,c){var o=t.apply(n,i);function r(t){e(o,a,c,r,s,"next",t)}function s(t){e(o,a,c,r,s,"throw",t)}r(void 0)}))}}function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{NyRW:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n("ofXK"),c=n("5dmV"),o=n("fXoL"),r=function(){var e=function e(){a(this,e)};return e.\u0275mod=o.Kb({type:e}),e.\u0275inj=o.Jb({factory:function(t){return new(t||e)},imports:[[i.c,c.a]]}),e}()},"Q92/":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n("ofXK"),c=n("5dmV"),o=n("fXoL"),r=function(){var e=function e(){a(this,e)};return e.\u0275mod=o.Kb({type:e}),e.\u0275inj=o.Jb({factory:function(t){return new(t||e)},imports:[[i.c,c.a]]}),e}()},XURG:function(e,n,c){"use strict";c.r(n),c.d(n,"FaceRecognitionModule",(function(){return Q}));var o=c("3Pt+"),r=c("ofXK"),s=c("tyNb"),l=c("S0DU"),u=c("qzk7"),d=c("fXoL"),h=c("42F4"),m=c("0IaG"),p=c("dNgK"),f=c("tk/3"),b=c("zkoq"),g=c("Wp6s"),v=c("NFeN"),w=c("Xa2L"),y=c("A5z7"),k=c("R0Ic"),R=c("LRne"),S=c("lJxs"),F=c("vkgz"),C=c("NJ9Y"),I=c("JIr8"),E=c("bTqV");function P(e,t){1&e&&d.Nb(0,"li"),2&e&&d.jc("@fadeInOut",t.$implicit.state)}var x,M=((x=function(){function e(t,n){a(this,e),this.http=n,this.text="Upload",this.param="file",this.target="https://file.io",this.accept="image/*",this.complete=new d.o,this.files=[]}return i(e,[{key:"ngOnInit",value:function(){}},{key:"onClick",value:function(){var e=this,t=document.getElementById("fileUpload"),n=new FileReader;t.onchange=function(){for(var i=function(i){var a=t.files[i];n.readAsDataURL(a),n.onload=function(t){var n={data:a,state:"in",result:t.target.result,inProgress:!1,progress:0,canRetry:!1,canCancel:!0};e.files.push(n),console.log(n),e.complete.emit(n)}},a=0;a<t.files.length;a++)i(a)},t.click()}},{key:"cancelFile",value:function(e){e.sub.unsubscribe(),this.removeFileFromArray(e)}},{key:"retryFile",value:function(e){this.uploadFile(e),e.canRetry=!1}},{key:"uploadFile",value:function(e){var t=this,n=new FormData;n.append(this.param,e.data),console.log(e);var i=new f.e("POST",this.target,n,{reportProgress:!0});e.inProgress=!0,e.sub=this.http.request(i).pipe(Object(S.a)((function(t){switch(t.type){case f.d.UploadProgress:e.progress=Math.round(100*t.loaded/t.total);break;case f.d.Response:return t}})),Object(F.a)((function(e){})),Object(C.a)(),Object(I.a)((function(t){return e.inProgress=!1,e.canRetry=!0,Object(R.a)(e.data.name+" upload failed.")}))).subscribe((function(n){"object"==typeof n&&(t.removeFileFromArray(e),t.complete.emit(e))}))}},{key:"uploadFiles",value:function(){var e=this;document.getElementById("fileUpload").value="",this.files.forEach((function(t){e.uploadFile(t)}))}},{key:"removeFileFromArray",value:function(e){var t=this.files.indexOf(e);t>-1&&this.files.splice(t,1)}}]),e}()).\u0275fac=function(e){return new(e||x)(d.Mb(x,12),d.Mb(f.a))},x.\u0275cmp=d.Gb({type:x,selectors:[["app-file-upload"]],inputs:{text:"text",param:"param",target:"target",accept:"accept"},outputs:{complete:"complete"},decls:8,vars:3,consts:[["mat-button","","color","warn",3,"click"],[4,"ngFor","ngForOf"],["type","file","id","fileUpload","name","fileUpload","multiple","multiple",2,"display","none",3,"accept"]],template:function(e,t){1&e&&(d.Sb(0,"button",0),d.ac("click",(function(){return t.onClick()})),d.Sb(1,"mat-icon"),d.Cc(2,"file_upload"),d.Rb(),d.Cc(3),d.Rb(),d.Nb(4,"br"),d.Sb(5,"ul"),d.Bc(6,P,1,1,"li",1),d.Rb(),d.Nb(7,"input",2)),2&e&&(d.Bb(3),d.Ec(" ",t.text,"\n"),d.Bb(3),d.jc("ngForOf",t.files),d.Bb(1),d.kc("accept",t.accept))},directives:[E.a,v.a,r.j],styles:["li[_ngcontent-%COMP%], ul[_ngcontent-%COMP%]{margin:0;padding:0;list-style:none}#file-label[_ngcontent-%COMP%]{display:inline-flex;vertical-align:middle;font-size:12px;line-height:18px}#file-label[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;text-align:center}#file-label[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{cursor:pointer}"],data:{animation:[Object(k.m)("fadeInOut",[Object(k.j)("in",Object(k.k)({opacity:100})),Object(k.l)("* => void",[Object(k.e)(300,Object(k.k)({opacity:0}))])])]}}),x),O=["video"],L=["c1"],j=["canvasLast"],B=["canvasPrior"],D=["second"];function W(e,t){1&e&&(d.Sb(0,"div",18),d.Sb(1,"div",19),d.Nb(2,"mat-progress-spinner",20),d.Rb(),d.Rb())}function H(e,t){if(1&e){var n=d.Tb();d.Sb(0,"mat-chip",21),d.ac("click",(function(){return d.tc(n),d.ec().compareImages()})),d.Cc(1,"Compare images"),d.Rb()}}function U(e,t){if(1&e){var n=d.Tb();d.Sb(0,"mat-card-subtitle"),d.Sb(1,"mat-chip",21),d.ac("click",(function(){return d.tc(n),d.ec().compareImages()})),d.Cc(2,"Compare images"),d.Rb(),d.Rb()}}function _(e,t){if(1&e){var n=d.Tb();d.Sb(0,"mat-card-actions"),d.Sb(1,"mat-chip-list"),d.Sb(2,"mat-chip",22),d.ac("click",(function(){return d.tc(n),d.ec().captureImageFirst()})),d.Cc(3,"Capture first image from camera"),d.Rb(),d.Sb(4,"mat-chip",22),d.ac("click",(function(){return d.tc(n),d.ec().captureImageSecond()})),d.Cc(5,"Capture second image from camera"),d.Rb(),d.Rb(),d.Rb()}}function N(e,t){if(1&e){var n=d.Tb();d.Sb(0,"mat-chip",24),d.Sb(1,"app-file-upload",25,26),d.ac("complete",(function(e){return d.tc(n),d.ec(2).onFileCompleteFirst(e)})),d.Rb(),d.Rb()}}function T(e,t){if(1&e){var n=d.Tb();d.Sb(0,"mat-card-actions"),d.Sb(1,"mat-chip-list"),d.Sb(2,"mat-chip",22),d.ac("click",(function(){return d.tc(n),d.ec().captureImageFirst()})),d.Cc(3,"Capture image from camera"),d.Rb(),d.Bc(4,N,3,0,"mat-chip",23),d.Rb(),d.Rb()}if(2&e){var i=d.ec();d.Bb(4),d.jc("ngIf",i.showUpload)}}function z(e,t){if(1&e){var n=d.Tb();d.Sb(0,"mat-chip",24),d.Sb(1,"app-file-upload",25,27),d.ac("complete",(function(e){return d.tc(n),d.ec(2).onFileCompleteSecond(e)})),d.Rb(),d.Rb()}}function A(e,t){if(1&e){var n=d.Tb();d.Sb(0,"mat-card-actions"),d.Sb(1,"mat-chip-list"),d.Sb(2,"mat-chip",22),d.ac("click",(function(){return d.tc(n),d.ec().captureImageSecond()})),d.Cc(3,"Capture image from camera"),d.Rb(),d.Bc(4,z,3,0,"mat-chip",23),d.Rb(),d.Rb()}if(2&e){var i=d.ec();d.Bb(4),d.jc("ngIf",i.showUpload)}}var X,J,K=[{path:"",component:(X=function(){function e(t,n,i,c,o,r){a(this,e),this.renderer=t,this.os=n,this.dialog=i,this.snackBar=c,this.httpClient=o,this.ngZone=r,this.MODEL_URL="../../assets/weights",this.constraints={audio:!1,video:{facingMode:"selfie",width:{ideal:4096},height:{ideal:2160}}},this.mtcnnForwardParams={minFaceSize:200,scaleFactor:.709,maxNumScales:10,scoreThresholds:[.6,.7,.7]},this.videoWidth=0,this.videoHeight=0,this.result=0,this.valueInput="",this.images=[],this.matched="These faces belong to different people!",this.maxDescriptorDistance=.4,this.IsWait=!1,this.switchimage=1,this.showUpload=!1,this.text="Allow the browser to use your camera and click on video to capture image or press buttons below, or either click on image holders on the left/below. The demo uses only browsers computing power, now backend server",this.mobileHide=!1,this.showUpload="localhost"===window.location.hostname,/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(this.constraints.video.facingMode="user",this.text="Allow the browser to use your camera and tap on the video to capture image. The demo uses only browsers computing power, now backend server",this.mobileHide=!0),Promise.all([this.loadF(this.MODEL_URL,"loadSsdMobilenetv1Model").then((function(e){console.log(e)})).catch((function(e){console.log(e)})).finally((function(){console.log("done")})),this.loadF(this.MODEL_URL,"loadFaceDetectionModel").then((function(e){console.log(e)})).catch((function(e){console.log(e)})).finally((function(){console.log("done")})),this.loadF(this.MODEL_URL,"loadFaceLandmarkModel").then((function(e){console.log(e)})).catch((function(e){console.log(e)})).finally((function(){console.log("done")})),this.loadF(this.MODEL_URL,"loadFaceRecognitionModel").then((function(e){console.log(e)})).catch((function(e){console.log(e)})).finally((function(){console.log("done")}))]).then((function(e){console.log(e)})).catch((function(e){return console.log(e)})).finally((function(){console.log("done loading"),console.log(u)}))}var n,c,o;return i(e,[{key:"ngOnInit",value:function(){console.log(u),this.breakpoint=window.innerWidth<=400?1:2,this.startCamera()}},{key:"onResize",value:function(e){this.breakpoint=e.target.innerWidth<=4?1:2,this.screenWidth=window.innerWidth,this.screenHeight=window.innerHeight}},{key:"loadF",value:(o=t(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u[n](t);case 2:case"end":return e.stop()}}),e)}))),function(e,t){return o.apply(this,arguments)})},{key:"handleError",value:function(e){console.log("Error: ",e)}},{key:"attachVideo",value:function(e){var t=this;this.renderer.setProperty(this.videoElement.nativeElement,"srcObject",e),this.renderer.listen(this.videoElement.nativeElement,"play",(function(e){t.videoHeight=t.videoElement.nativeElement.videoHeight,t.videoWidth=t.videoElement.nativeElement.videoWidth})),console.log(this.videoHeight)}},{key:"startCamera",value:function(){navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(this.constraints).then(this.attachVideo.bind(this)).catch(this.handleError):alert("Camera not available.")}},{key:"captureImageFirst",value:function(){this.renderer.setProperty(this.canvasLast.nativeElement,"width",this.videoWidth),this.renderer.setProperty(this.canvasLast.nativeElement,"height",this.videoHeight),this.canvasLast.nativeElement.getContext("2d").drawImage(this.videoElement.nativeElement,0,0)}},{key:"captureImageSecond",value:function(){this.renderer.setProperty(this.canvasPrior.nativeElement,"width",this.videoWidth),this.renderer.setProperty(this.canvasPrior.nativeElement,"height",this.videoHeight),this.canvasPrior.nativeElement.getContext("2d").drawImage(this.videoElement.nativeElement,0,0)}},{key:"capture",value:function(){1===this.switchimage?(this.switchimage=2,this.captureImageFirst()):(this.switchimage=1,this.captureImageSecond())}},{key:"compareImages",value:(c=t(regeneratorRuntime.mark((function e(){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.IsWait=!0,this.ngZone.run((function(){n.IsWait=!0})),setTimeout(t(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.computeSingleFaceDescriptors(n.canvasLast.nativeElement,n.canvasPrior.nativeElement,"Lyudmil",n.videoHeight,n.videoWidth);case 2:t=e.sent,console.log(t),t<=n.maxDescriptorDistance?(n.matched="The faces belong to one person!",n.openDialog(n.matched),n.IsWait=!1):(n.matched="It is hard to tell if that is the same person!",n.openDialog(n.matched),n.IsWait=!1);case 4:case"end":return e.stop()}}),e)}))),20);case 1:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"computeSingleFaceDescriptors",value:(n=t(regeneratorRuntime.mark((function e(t,n,i,a,c){var o,r,s,l,d,h,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={width:c,height:a},r=1,e.prev=2,e.next=5,u.detectSingleFace(t).withFaceLandmarks().withFaceDescriptor();case 5:return s=e.sent,s=u.resizeResults(s,o),e.next=9,u.detectSingleFace(n).withFaceLandmarks().withFaceDescriptor();case 9:l=e.sent,l=u.resizeResults(l,o),void 0!==s&&(u.draw.drawDetections(t,s),u.draw.drawFaceLandmarks(t,s)),void 0!==l&&(u.draw.drawDetections(n,l),u.draw.drawFaceLandmarks(n,l)),console.log([s.descriptor]),d=[l.descriptor],console.log(d),h=new u.LabeledFaceDescriptors("Prior",d),m=new u.FaceMatcher(h,this.maxDescriptorDistance),r=[s].map((function(e){return m.findBestMatch(e.descriptor)}))[0]._distance,e.next=20;break;case 17:e.prev=17,e.t0=e.catch(2),console.log(e.t0);case 20:return e.prev=20,console.log("done"),e.finish(20);case 23:return e.abrupt("return",r);case 24:case"end":return e.stop()}}),e,this,[[2,17,20,23]])}))),function(e,t,i,a,c){return n.apply(this,arguments)})},{key:"openDialog",value:function(e){this.dialog.open(l.a,{data:{message:e,buttonText:{ok:"Save",cancel:"No"}}}).afterClosed().subscribe((function(e){console.log(e)}))}},{key:"onFileCompleteFirst",value:function(e){var t=this,n=new Image;n.src=e.result,n.onload=function(){var e=n.naturalWidth,i=t.canvasLast.nativeElement.width,a=1;e>i&&(a=i/e);var c=n.naturalHeight,o=t.canvasLast.nativeElement.height,r=1;c>o&&(r=o/c);var s=r;a<r&&(s=a),s<1&&(c*=s,e*=s),t.canvasLast.nativeElement.height=c,t.canvasLast.nativeElement.width=e,t.clearFirst(),t.canvasLast.nativeElement.getContext("2d").drawImage(n,0,0,n.naturalWidth,n.naturalHeight,0,0,e,c)}}},{key:"onFileCompleteSecond",value:function(e){var t=this,n=new Image;n.src=e.result,n.onload=function(){var e=n.naturalWidth,i=t.canvasPrior.nativeElement.width,a=1;e>i&&(a=i/e);var c=n.naturalHeight,o=t.canvasPrior.nativeElement.height,r=1;c>o&&(r=o/c);var s=r;a<r&&(s=a),s<1&&(c*=s,e*=s),t.canvasPrior.nativeElement.height=c,t.canvasPrior.nativeElement.width=e,t.clearSecond(),t.canvasPrior.nativeElement.getContext("2d").drawImage(n,0,0,n.naturalWidth,n.naturalHeight,0,0,e,c)}}},{key:"clearFirst",value:function(){var e=this.canvasLast.nativeElement.getContext("2d");e.clearRect(0,0,e.canvas.width,e.canvas.height),e.restore()}},{key:"clearSecond",value:function(){var e=this.canvasPrior.nativeElement.getContext("2d");e.clearRect(0,0,e.canvas.width,e.canvas.height),e.restore()}},{key:"ngAfterViewInit",value:function(){console.log(this.c1)}}]),e}(),X.\u0275fac=function(e){return new(e||X)(d.Mb(d.G),d.Mb(h.b),d.Mb(m.b),d.Mb(p.a),d.Mb(f.a),d.Mb(d.B))},X.\u0275cmp=d.Gb({type:X,selectors:[["ng-component"]],viewQuery:function(e,t){var n;1&e&&(d.xc(O,!0),d.xc(L,!0),d.xc(j,!0),d.xc(B,!0),d.Fc(D,!0)),2&e&&(d.pc(n=d.bc())&&(t.videoElement=n.first),d.pc(n=d.bc())&&(t.c1=n.first),d.pc(n=d.bc())&&(t.canvasLast=n.first),d.pc(n=d.bc())&&(t.canvasPrior=n.first),d.pc(n=d.bc())&&(t.secondUpload=n.first))},decls:44,vars:15,consts:[["class","overlay",4,"ngIf"],["fxLayout","row wrap"],["selected","true","class","pointer",3,"click",4,"ngIf"],["rowHeight","3:1",3,"cols","gutterSize","resize"],["fxLayoutAlign","center center"],[3,"colspan","rowspan"],[3,"click"],["c1",""],[4,"ngIf"],[1,"p-1"],["autoplay","","muted","",1,"vid"],["video",""],[2,"margin-top","10px"],[1,"close-right",3,"click"],[1,"vid"],["canvasLast",""],[1,"p-1",3,"click"],["canvasPrior",""],[1,"overlay"],[1,"center"],["diameter","100","mode","indeterminate"],["selected","true",1,"pointer",3,"click"],["color","accent","selected","true",1,"pointer",3,"click"],["color","accent","selected","true","class","pointer",4,"ngIf"],["color","accent","selected","true",1,"pointer"],[3,"complete"],["first",""],["second",""]],template:function(e,t){1&e&&(d.Bc(0,W,3,0,"div",0),d.Nb(1,"br"),d.Sb(2,"div",1),d.Bc(3,H,2,0,"mat-chip",2),d.Sb(4,"mat-grid-list",3),d.ac("resize",(function(e){return t.onResize(e)}),!1,d.sc),d.Sb(5,"div",4),d.Sb(6,"mat-grid-tile",5),d.Sb(7,"mat-card",6,7),d.ac("click",(function(){return t.capture()})),d.Sb(9,"mat-card-header"),d.Bc(10,U,3,0,"mat-card-subtitle",8),d.Rb(),d.Sb(11,"mat-card-content"),d.Sb(12,"div",9),d.Nb(13,"video",10,11),d.Rb(),d.Sb(15,"p"),d.Cc(16),d.Rb(),d.Bc(17,_,6,0,"mat-card-actions",8),d.Rb(),d.Rb(),d.Rb(),d.Rb(),d.Sb(18,"div",4),d.Sb(19,"mat-grid-tile",5),d.Sb(20,"mat-card"),d.Sb(21,"mat-card-header",12),d.Sb(22,"mat-icon",13),d.ac("click",(function(){return t.clearFirst()})),d.Cc(23,"cancel"),d.Rb(),d.Sb(24,"mat-card-subtitle"),d.Cc(25,"First Image "),d.Rb(),d.Rb(),d.Sb(26,"mat-card-content",6),d.ac("click",(function(){return t.captureImageFirst()})),d.Sb(27,"div",9),d.Nb(28,"canvas",14,15),d.Rb(),d.Bc(30,T,5,1,"mat-card-actions",8),d.Rb(),d.Rb(),d.Rb(),d.Rb(),d.Sb(31,"div",4),d.Sb(32,"mat-grid-tile",5),d.Sb(33,"mat-card"),d.Sb(34,"mat-card-header"),d.Sb(35,"mat-icon",13),d.ac("click",(function(){return t.clearSecond()})),d.Cc(36,"cancel"),d.Rb(),d.Sb(37,"mat-card-subtitle"),d.Cc(38,"Second Image "),d.Rb(),d.Rb(),d.Sb(39,"div",16),d.ac("click",(function(){return t.captureImageSecond()})),d.Nb(40,"canvas",14,17),d.Rb(),d.Sb(42,"mat-card-content",6),d.ac("click",(function(){return t.captureImageSecond()})),d.Rb(),d.Bc(43,A,5,1,"mat-card-actions",8),d.Rb(),d.Rb(),d.Rb(),d.Rb(),d.Rb()),2&e&&(d.jc("ngIf",t.IsWait),d.Bb(3),d.jc("ngIf",t.mobileHide),d.Bb(1),d.jc("cols",t.breakpoint)("gutterSize","10px"),d.Bb(2),d.jc("colspan",1)("rowspan",3),d.Bb(4),d.jc("ngIf",!t.mobileHide),d.Bb(6),d.Ec(" ",t.text," "),d.Bb(1),d.jc("ngIf",!t.mobileHide),d.Bb(2),d.jc("colspan",1)("rowspan",2),d.Bb(11),d.jc("ngIf",!t.mobileHide),d.Bb(2),d.jc("colspan",1)("rowspan",2),d.Bb(11),d.jc("ngIf",!t.mobileHide))},directives:[r.k,b.a,b.c,g.a,g.d,g.c,v.a,g.f,w.a,y.a,g.b,y.b,M],styles:[".vid[_ngcontent-%COMP%]{width:100%;height:100%}.mat-chip[_ngcontent-%COMP%]{justify-content:space-between}.pointer[_ngcontent-%COMP%]{cursor:pointer}.center[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translateX(-50%) translateY(-50%)}.overlay[_ngcontent-%COMP%]{height:100vh;width:100%;background-color:rgba(0,0,0,.286);z-index:10;top:0;left:0;position:fixed;background:#000;opacity:.75!important}body[_ngcontent-%COMP%]{margin:0}.close-right[_ngcontent-%COMP%]{cursor:pointer;position:absolute;right:0;margin-right:10px}"]}),X)}],V=c("5dmV"),G=c("Q92/"),q=c("NyRW"),Q=((J=function e(){a(this,e)}).\u0275mod=d.Kb({type:J}),J.\u0275inj=d.Jb({factory:function(e){return new(e||J)},providers:[h.b],imports:[[s.e.forChild(K),o.o,o.h,r.c,V.a,G.a,q.a]]}),J)}}])}();