(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{NyRW:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var a=i("ofXK"),n=i("5dmV"),c=i("fXoL");let o=(()=>{class e{}return e.\u0275mod=c.Kb({type:e}),e.\u0275inj=c.Jb({factory:function(t){return new(t||e)},imports:[[a.c,n.a]]}),e})()},"Q92/":function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var a=i("ofXK"),n=i("5dmV"),c=i("fXoL");let o=(()=>{class e{}return e.\u0275mod=c.Kb({type:e}),e.\u0275inj=c.Jb({factory:function(t){return new(t||e)},imports:[[a.c,n.a]]}),e})()},XURG:function(e,t,i){"use strict";i.r(t),i.d(t,"FaceRecognitionModule",(function(){return X}));var a=i("3Pt+"),n=i("ofXK"),c=i("tyNb"),o=i("S0DU"),s=i("qzk7"),r=i("fXoL"),l=i("42F4"),d=i("0IaG"),h=i("dNgK"),m=i("tk/3"),b=i("zkoq"),p=i("Wp6s"),g=i("NFeN"),u=i("Xa2L"),f=i("A5z7"),v=i("R0Ic"),w=i("LRne"),S=i("lJxs"),R=i("vkgz"),y=i("NJ9Y"),F=i("JIr8"),I=i("bTqV");function C(e,t){1&e&&r.Nb(0,"li"),2&e&&r.jc("@fadeInOut",t.$implicit.state)}let k=(()=>{class e{constructor(e,t){this.http=t,this.text="Upload",this.param="file",this.target="https://file.io",this.accept="image/*",this.complete=new r.o,this.files=[]}ngOnInit(){}onClick(){const e=document.getElementById("fileUpload"),t=new FileReader;e.onchange=()=>{for(let i=0;i<e.files.length;i++){const a=e.files[i];t.readAsDataURL(a),t.onload=e=>{const t={data:a,state:"in",result:e.target.result,inProgress:!1,progress:0,canRetry:!1,canCancel:!0};this.files.push(t),console.log(t),this.complete.emit(t)}}},e.click()}cancelFile(e){e.sub.unsubscribe(),this.removeFileFromArray(e)}retryFile(e){this.uploadFile(e),e.canRetry=!1}uploadFile(e){const t=new FormData;t.append(this.param,e.data),console.log(e);const i=new m.e("POST",this.target,t,{reportProgress:!0});e.inProgress=!0,e.sub=this.http.request(i).pipe(Object(S.a)(t=>{switch(t.type){case m.d.UploadProgress:e.progress=Math.round(100*t.loaded/t.total);break;case m.d.Response:return t}}),Object(R.a)(e=>{}),Object(y.a)(),Object(F.a)(t=>(e.inProgress=!1,e.canRetry=!0,Object(w.a)(e.data.name+" upload failed.")))).subscribe(t=>{"object"==typeof t&&(this.removeFileFromArray(e),this.complete.emit(e))})}uploadFiles(){document.getElementById("fileUpload").value="",this.files.forEach(e=>{this.uploadFile(e)})}removeFileFromArray(e){const t=this.files.indexOf(e);t>-1&&this.files.splice(t,1)}}return e.\u0275fac=function(t){return new(t||e)(r.Mb(e,12),r.Mb(m.a))},e.\u0275cmp=r.Gb({type:e,selectors:[["app-file-upload"]],inputs:{text:"text",param:"param",target:"target",accept:"accept"},outputs:{complete:"complete"},decls:8,vars:3,consts:[["mat-button","","color","warn",3,"click"],[4,"ngFor","ngForOf"],["type","file","id","fileUpload","name","fileUpload","multiple","multiple",2,"display","none",3,"accept"]],template:function(e,t){1&e&&(r.Sb(0,"button",0),r.ac("click",(function(){return t.onClick()})),r.Sb(1,"mat-icon"),r.Cc(2,"file_upload"),r.Rb(),r.Cc(3),r.Rb(),r.Nb(4,"br"),r.Sb(5,"ul"),r.Bc(6,C,1,1,"li",1),r.Rb(),r.Nb(7,"input",2)),2&e&&(r.Bb(3),r.Ec(" ",t.text,"\n"),r.Bb(3),r.jc("ngForOf",t.files),r.Bb(1),r.kc("accept",t.accept))},directives:[I.a,g.a,n.j],styles:["li[_ngcontent-%COMP%], ul[_ngcontent-%COMP%]{margin:0;padding:0;list-style:none}#file-label[_ngcontent-%COMP%]{display:inline-flex;vertical-align:middle;font-size:12px;line-height:18px}#file-label[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;text-align:center}#file-label[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{cursor:pointer}"],data:{animation:[Object(v.m)("fadeInOut",[Object(v.j)("in",Object(v.k)({opacity:100})),Object(v.l)("* => void",[Object(v.e)(300,Object(v.k)({opacity:0}))])])]}}),e})();const E=["video"],P=["c1"],M=["canvasLast"],O=["canvasPrior"],L=["second"];function x(e,t){1&e&&(r.Sb(0,"div",18),r.Sb(1,"div",19),r.Nb(2,"mat-progress-spinner",20),r.Rb(),r.Rb())}function j(e,t){if(1&e){const e=r.Tb();r.Sb(0,"mat-chip",21),r.ac("click",(function(){return r.tc(e),r.ec().compareImages()})),r.Cc(1,"Compare images"),r.Rb()}}function B(e,t){if(1&e){const e=r.Tb();r.Sb(0,"mat-card-subtitle"),r.Sb(1,"mat-chip",21),r.ac("click",(function(){return r.tc(e),r.ec().compareImages()})),r.Cc(2,"Compare images"),r.Rb(),r.Rb()}}function D(e,t){if(1&e){const e=r.Tb();r.Sb(0,"mat-card-actions"),r.Sb(1,"mat-chip-list"),r.Sb(2,"mat-chip",22),r.ac("click",(function(){return r.tc(e),r.ec().captureImageFirst()})),r.Cc(3,"Capture first image from camera"),r.Rb(),r.Sb(4,"mat-chip",22),r.ac("click",(function(){return r.tc(e),r.ec().captureImageSecond()})),r.Cc(5,"Capture second image from camera"),r.Rb(),r.Rb(),r.Rb()}}function W(e,t){if(1&e){const e=r.Tb();r.Sb(0,"mat-chip",24),r.Sb(1,"app-file-upload",25,26),r.ac("complete",(function(t){return r.tc(e),r.ec(2).onFileCompleteFirst(t)})),r.Rb(),r.Rb()}}function H(e,t){if(1&e){const e=r.Tb();r.Sb(0,"mat-card-actions"),r.Sb(1,"mat-chip-list"),r.Sb(2,"mat-chip",22),r.ac("click",(function(){return r.tc(e),r.ec().captureImageFirst()})),r.Cc(3,"Capture image from camera"),r.Rb(),r.Bc(4,W,3,0,"mat-chip",23),r.Rb(),r.Rb()}if(2&e){const e=r.ec();r.Bb(4),r.jc("ngIf",e.showUpload)}}function U(e,t){if(1&e){const e=r.Tb();r.Sb(0,"mat-chip",24),r.Sb(1,"app-file-upload",25,27),r.ac("complete",(function(t){return r.tc(e),r.ec(2).onFileCompleteSecond(t)})),r.Rb(),r.Rb()}}function _(e,t){if(1&e){const e=r.Tb();r.Sb(0,"mat-card-actions"),r.Sb(1,"mat-chip-list"),r.Sb(2,"mat-chip",22),r.ac("click",(function(){return r.tc(e),r.ec().captureImageSecond()})),r.Cc(3,"Capture image from camera"),r.Rb(),r.Bc(4,U,3,0,"mat-chip",23),r.Rb(),r.Rb()}if(2&e){const e=r.ec();r.Bb(4),r.jc("ngIf",e.showUpload)}}const N=[{path:"",component:(()=>{class e{constructor(e,t,i,a,n,c){this.renderer=e,this.os=t,this.dialog=i,this.snackBar=a,this.httpClient=n,this.ngZone=c,this.MODEL_URL="../../assets/weights",this.constraints={audio:!1,video:{facingMode:"selfie",width:{ideal:4096},height:{ideal:2160}}},this.mtcnnForwardParams={minFaceSize:200,scaleFactor:.709,maxNumScales:10,scoreThresholds:[.6,.7,.7]},this.videoWidth=0,this.videoHeight=0,this.result=0,this.valueInput="",this.images=[],this.matched="These faces belong to different people!",this.maxDescriptorDistance=.4,this.IsWait=!1,this.switchimage=1,this.showUpload=!1,this.text="Allow the browser to use your camera and click on video to capture image or press buttons below, or either click on image holders on the left/below. The demo uses only browsers computing power, now backend server",this.mobileHide=!1,this.showUpload="localhost"===window.location.hostname,/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(this.constraints.video.facingMode="user",this.text="Allow the browser to use your camera and tap on the video to capture image. The demo uses only browsers computing power, now backend server",this.mobileHide=!0),Promise.all([this.loadF(this.MODEL_URL,"loadSsdMobilenetv1Model").then(e=>{console.log(e)}).catch(e=>{console.log(e)}).finally(()=>{console.log("done")}),this.loadF(this.MODEL_URL,"loadFaceDetectionModel").then(e=>{console.log(e)}).catch(e=>{console.log(e)}).finally(()=>{console.log("done")}),this.loadF(this.MODEL_URL,"loadFaceLandmarkModel").then(e=>{console.log(e)}).catch(e=>{console.log(e)}).finally(()=>{console.log("done")}),this.loadF(this.MODEL_URL,"loadFaceRecognitionModel").then(e=>{console.log(e)}).catch(e=>{console.log(e)}).finally(()=>{console.log("done")})]).then(e=>{console.log(e)}).catch(e=>console.log(e)).finally(()=>{console.log("done loading"),console.log(s)})}ngOnInit(){console.log(s),this.breakpoint=window.innerWidth<=400?1:2,this.startCamera()}onResize(e){this.breakpoint=e.target.innerWidth<=4?1:2,this.screenWidth=window.innerWidth,this.screenHeight=window.innerHeight}async loadF(e,t){await s[t](e)}handleError(e){console.log("Error: ",e)}attachVideo(e){this.renderer.setProperty(this.videoElement.nativeElement,"srcObject",e),this.renderer.listen(this.videoElement.nativeElement,"play",e=>{this.videoHeight=this.videoElement.nativeElement.videoHeight,this.videoWidth=this.videoElement.nativeElement.videoWidth}),console.log(this.videoHeight)}startCamera(){navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(this.constraints).then(this.attachVideo.bind(this)).catch(this.handleError):alert("Camera not available.")}captureImageFirst(){this.renderer.setProperty(this.canvasLast.nativeElement,"width",this.videoWidth),this.renderer.setProperty(this.canvasLast.nativeElement,"height",this.videoHeight),this.canvasLast.nativeElement.getContext("2d").drawImage(this.videoElement.nativeElement,0,0)}captureImageSecond(){this.renderer.setProperty(this.canvasPrior.nativeElement,"width",this.videoWidth),this.renderer.setProperty(this.canvasPrior.nativeElement,"height",this.videoHeight),this.canvasPrior.nativeElement.getContext("2d").drawImage(this.videoElement.nativeElement,0,0)}capture(){1===this.switchimage?(this.switchimage=2,this.captureImageFirst()):(this.switchimage=1,this.captureImageSecond())}async compareImages(){this.IsWait=!0,this.ngZone.run(()=>{this.IsWait=!0}),setTimeout(async()=>{const e=await this.computeSingleFaceDescriptors(this.canvasLast.nativeElement,this.canvasPrior.nativeElement,"Lyudmil",this.videoHeight,this.videoWidth);console.log(e),e<=this.maxDescriptorDistance?(this.matched="The faces belong to one person!",this.openDialog(this.matched),this.IsWait=!1):(this.matched="It is hard to tell if that is the same person!",this.openDialog(this.matched),this.IsWait=!1)},20)}async computeSingleFaceDescriptors(e,t,i,a,n){const c={width:n,height:a};let o=1;try{let i=await s.detectSingleFace(e).withFaceLandmarks().withFaceDescriptor();i=s.resizeResults(i,c);let a=await s.detectSingleFace(t).withFaceLandmarks().withFaceDescriptor();a=s.resizeResults(a,c),void 0!==i&&(s.draw.drawDetections(e,i),s.draw.drawFaceLandmarks(e,i)),void 0!==a&&(s.draw.drawDetections(t,a),s.draw.drawFaceLandmarks(t,a)),console.log([i.descriptor]);const n=[a.descriptor];console.log(n);const r=new s.LabeledFaceDescriptors("Prior",n),l=new s.FaceMatcher(r,this.maxDescriptorDistance);o=[i].map(e=>l.findBestMatch(e.descriptor))[0]._distance}catch(r){console.log(r)}finally{console.log("done")}return o}openDialog(e){this.dialog.open(o.a,{data:{message:e,buttonText:{ok:"Save",cancel:"No"}}}).afterClosed().subscribe(e=>{console.log(e)})}onFileCompleteFirst(e){const t=new Image;t.src=e.result,t.onload=()=>{let e=t.naturalWidth;const i=this.canvasLast.nativeElement.width;let a=1;e>i&&(a=i/e);let n=t.naturalHeight;const c=this.canvasLast.nativeElement.height;let o=1;n>c&&(o=c/n);let s=o;a<o&&(s=a),s<1&&(n*=s,e*=s),this.canvasLast.nativeElement.height=n,this.canvasLast.nativeElement.width=e,this.clearFirst(),this.canvasLast.nativeElement.getContext("2d").drawImage(t,0,0,t.naturalWidth,t.naturalHeight,0,0,e,n)}}onFileCompleteSecond(e){const t=new Image;t.src=e.result,t.onload=()=>{let e=t.naturalWidth;const i=this.canvasPrior.nativeElement.width;let a=1;e>i&&(a=i/e);let n=t.naturalHeight;const c=this.canvasPrior.nativeElement.height;let o=1;n>c&&(o=c/n);let s=o;a<o&&(s=a),s<1&&(n*=s,e*=s),this.canvasPrior.nativeElement.height=n,this.canvasPrior.nativeElement.width=e,this.clearSecond(),this.canvasPrior.nativeElement.getContext("2d").drawImage(t,0,0,t.naturalWidth,t.naturalHeight,0,0,e,n)}}clearFirst(){const e=this.canvasLast.nativeElement.getContext("2d");e.clearRect(0,0,e.canvas.width,e.canvas.height),e.restore()}clearSecond(){const e=this.canvasPrior.nativeElement.getContext("2d");e.clearRect(0,0,e.canvas.width,e.canvas.height),e.restore()}ngAfterViewInit(){console.log(this.c1)}}return e.\u0275fac=function(t){return new(t||e)(r.Mb(r.G),r.Mb(l.b),r.Mb(d.b),r.Mb(h.a),r.Mb(m.a),r.Mb(r.B))},e.\u0275cmp=r.Gb({type:e,selectors:[["ng-component"]],viewQuery:function(e,t){if(1&e&&(r.xc(E,!0),r.xc(P,!0),r.xc(M,!0),r.xc(O,!0),r.Fc(L,!0)),2&e){let e;r.pc(e=r.bc())&&(t.videoElement=e.first),r.pc(e=r.bc())&&(t.c1=e.first),r.pc(e=r.bc())&&(t.canvasLast=e.first),r.pc(e=r.bc())&&(t.canvasPrior=e.first),r.pc(e=r.bc())&&(t.secondUpload=e.first)}},decls:44,vars:15,consts:[["class","overlay",4,"ngIf"],["fxLayout","row wrap"],["selected","true","class","pointer",3,"click",4,"ngIf"],["rowHeight","3:1",3,"cols","gutterSize","resize"],["fxLayoutAlign","center center"],[3,"colspan","rowspan"],[3,"click"],["c1",""],[4,"ngIf"],[1,"p-1"],["autoplay","","muted","",1,"vid"],["video",""],[2,"margin-top","10px"],[1,"close-right",3,"click"],[1,"vid"],["canvasLast",""],[1,"p-1",3,"click"],["canvasPrior",""],[1,"overlay"],[1,"center"],["diameter","100","mode","indeterminate"],["selected","true",1,"pointer",3,"click"],["color","accent","selected","true",1,"pointer",3,"click"],["color","accent","selected","true","class","pointer",4,"ngIf"],["color","accent","selected","true",1,"pointer"],[3,"complete"],["first",""],["second",""]],template:function(e,t){1&e&&(r.Bc(0,x,3,0,"div",0),r.Nb(1,"br"),r.Sb(2,"div",1),r.Bc(3,j,2,0,"mat-chip",2),r.Sb(4,"mat-grid-list",3),r.ac("resize",(function(e){return t.onResize(e)}),!1,r.sc),r.Sb(5,"div",4),r.Sb(6,"mat-grid-tile",5),r.Sb(7,"mat-card",6,7),r.ac("click",(function(){return t.capture()})),r.Sb(9,"mat-card-header"),r.Bc(10,B,3,0,"mat-card-subtitle",8),r.Rb(),r.Sb(11,"mat-card-content"),r.Sb(12,"div",9),r.Nb(13,"video",10,11),r.Rb(),r.Sb(15,"p"),r.Cc(16),r.Rb(),r.Bc(17,D,6,0,"mat-card-actions",8),r.Rb(),r.Rb(),r.Rb(),r.Rb(),r.Sb(18,"div",4),r.Sb(19,"mat-grid-tile",5),r.Sb(20,"mat-card"),r.Sb(21,"mat-card-header",12),r.Sb(22,"mat-icon",13),r.ac("click",(function(){return t.clearFirst()})),r.Cc(23,"cancel"),r.Rb(),r.Sb(24,"mat-card-subtitle"),r.Cc(25,"First Image "),r.Rb(),r.Rb(),r.Sb(26,"mat-card-content",6),r.ac("click",(function(){return t.captureImageFirst()})),r.Sb(27,"div",9),r.Nb(28,"canvas",14,15),r.Rb(),r.Bc(30,H,5,1,"mat-card-actions",8),r.Rb(),r.Rb(),r.Rb(),r.Rb(),r.Sb(31,"div",4),r.Sb(32,"mat-grid-tile",5),r.Sb(33,"mat-card"),r.Sb(34,"mat-card-header"),r.Sb(35,"mat-icon",13),r.ac("click",(function(){return t.clearSecond()})),r.Cc(36,"cancel"),r.Rb(),r.Sb(37,"mat-card-subtitle"),r.Cc(38,"Second Image "),r.Rb(),r.Rb(),r.Sb(39,"div",16),r.ac("click",(function(){return t.captureImageSecond()})),r.Nb(40,"canvas",14,17),r.Rb(),r.Sb(42,"mat-card-content",6),r.ac("click",(function(){return t.captureImageSecond()})),r.Rb(),r.Bc(43,_,5,1,"mat-card-actions",8),r.Rb(),r.Rb(),r.Rb(),r.Rb(),r.Rb()),2&e&&(r.jc("ngIf",t.IsWait),r.Bb(3),r.jc("ngIf",t.mobileHide),r.Bb(1),r.jc("cols",t.breakpoint)("gutterSize","10px"),r.Bb(2),r.jc("colspan",1)("rowspan",3),r.Bb(4),r.jc("ngIf",!t.mobileHide),r.Bb(6),r.Ec(" ",t.text," "),r.Bb(1),r.jc("ngIf",!t.mobileHide),r.Bb(2),r.jc("colspan",1)("rowspan",2),r.Bb(11),r.jc("ngIf",!t.mobileHide),r.Bb(2),r.jc("colspan",1)("rowspan",2),r.Bb(11),r.jc("ngIf",!t.mobileHide))},directives:[n.k,b.a,b.c,p.a,p.d,p.c,g.a,p.f,u.a,f.a,p.b,f.b,k],styles:[".vid[_ngcontent-%COMP%]{width:100%;height:100%}.mat-chip[_ngcontent-%COMP%]{justify-content:space-between}.pointer[_ngcontent-%COMP%]{cursor:pointer}.center[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translateX(-50%) translateY(-50%)}.overlay[_ngcontent-%COMP%]{height:100vh;width:100%;background-color:rgba(0,0,0,.286);z-index:10;top:0;left:0;position:fixed;background:#000;opacity:.75!important}body[_ngcontent-%COMP%]{margin:0}.close-right[_ngcontent-%COMP%]{cursor:pointer;position:absolute;right:0;margin-right:10px}"]}),e})()}];var z=i("5dmV"),T=i("Q92/"),A=i("NyRW");let X=(()=>{class e{}return e.\u0275mod=r.Kb({type:e}),e.\u0275inj=r.Jb({factory:function(t){return new(t||e)},providers:[l.b],imports:[[c.e.forChild(N),a.o,a.h,n.c,z.a,T.a,A.a]]}),e})()}}]);